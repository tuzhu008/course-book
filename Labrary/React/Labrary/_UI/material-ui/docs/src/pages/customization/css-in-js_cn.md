# CSS in JS

Material-UI旨在为构建动态UI提供强大的基础。
为了简单起见，**我们向用户暴露了我们的内部样式解决方案。**
你可以用它，但你不需要。这个样式决绝方案与其他解决方案的解决方案是可互操作的像 [PostCSS](https://github.com/postcss/postcss), [CSS modules](https://github.com/css-modules), 或者 [styled-components](https://github.com/styled-components/styled-components).

## 我们的样式解决方案

在以前的版本中，Material-UI使用的LESS，然后是一个定制的行内样式的解决方案来编写组件的样式。
这些方法被证明是收到很多限制的。
最后,我们[走向](https://github.com/oliviertassinari/a-journey-toward-better-style)一个*CSS-in-JS*解决方案。它可以**解锁许多优秀的特性**(主题嵌套、动态样式、自支持等等)。

我们认为它是一个特性:
- [一个统一的样式语言](https://medium.com/seek-blog/a-unified-styling-language-d0c208de2660)
- [基于组件的样式的特性](https://medium.freecodecamp.com/css-in-javascript-the-future-of-component-based-styling-70b161a79a32)

你可能已经在演示中注意到这个*CSS-in-JS*的样子。
我们使用`withStyles`高阶组件。这里有一个例子:

{{demo='pages/customization/CssInJs.js'}}

## 退出rtl转换（Opting out of rtl transformation）


If you want to prevent a specific rule-set from being affected by the `rtl` transfomation you can add `flip: false` at the begining:如果你想防止某个特定的规则集受到`rtl`的转换影响，在开始的时候你可以添加`flip: false`:

*在左上角使用方向切换按钮来查看效果*

{{demo='pages/customization/RtlOptOut.js'}}

## JSS

Material-UI的样式解决方案使用了 [JSS](https://github.com/cssinjs/jss) 的狠心，
它是一个 [高性能](https://github.com/cssinjs/jss/blob/master/docs/performance.md)的在运行时和服务器端工作的JS 到 CSS的编译器。 
它大约有5 kB(缩小和压缩后)并且可通过[plugins](https://github.com/cssinjs/jss/blob/master/docs/plugins.md) API 扩展。

如果您最终在代码中使用了这个样式解决方案，那么您将需要学习API。
最好的开始是通过观察每个[plugin](http://cssinjs.org/plugins)提供的特性。 Material-UI使用的是[jss-preset-default](http://cssinjs.org/jss-preset-default) 模块。如果需要你可以使用[`JssProvider` helper](https://github.com/cssinjs/react-jss#custom-setup)随时添加新的插件。

同样,如果你希望构建自己的`jss`实例**和**支持*rtl*确保您还包括[jss-rtl](https://github.com/alitaheri/jss-rtl) 插件.
访问他们的[readme](https://github.com/alitaheri/jss-rtl#simple-usage)文件学习怎样做。


## Sheets registry（表注册）

当进行服务端渲染时，你将需要获取所有的被渲染的样式的字符串。`SheetsRegistry` class允许你手动聚合并将其进行字符串化。
阅读更多关于[服务器渲染](/guides/server-rendering).

{{demo='pages/customization/JssRegistry.js'}}

## Sheets manager （表管理）

我们使用一个 [引用计数](https://en.wikipedia.org/wiki/Reference_counting)算法是为了在每一对(样式，主题)中只连接和分离样式表。 

当只在客户端上渲染时，这不是您需要知道的事情。但是，当在服务器上渲染时，您会这样做。您可以在这里阅读更多关于[服务端渲染](/guides/server-rendering)的内容。

## Class names

You may have noticed, the class names generated by our styling solution are **non-deterministic**.
You can't rely on them. The following CSS won't work:
```css
.MuiAppBar-root-12 {
  opacity: 0.6
}
```

Instead, you have to use the `classes` property.
On the other hand, thanks to the non-deterministic nature of our class names, we
can implement optimization for development and production.
They are easy to debug in development and as short as possible in production:

- development: `.MuiAppBar-root-12`
- production: `.c12`

## CSS injection order

CSS注入顺序

在 `<head />`中使用`<link />`引入Material-UI的方式注入的组件样式具有最高的特殊性。
这样，我们确保组件总是正确地渲染。

但是，您可能还想要覆盖我们的样式，例如使用样式组件。
如果你正在经历一个CSS注入顺序问题， [JSS提供了一种处理这种情况的机制](https://github.com/cssinjs/jss/blob/master/docs/setup.md#specify-dom-insertion-point).
通过调整HTML主体中`insertionPoint` 注释的位置，[可以控制CSS规则应用到组件的顺序](http://cssinjs.org/js-api).

```jsx
<head>
  <!-- insertion-point-jss -->
  <title>Material-UI</title>
</head>
```

```jsx
import JssProvider from 'react-jss/lib/JssProvider';
import { create } from 'jss';
import preset from 'jss-preset-default';
import createGenerateClassName from 'material-ui/styles/createGenerateClassName';

const jss = create(preset());
// 自定义 Material-UI class名称生成器以更好的调试和优化性能。
jss.options.createGenerateClassName = createGenerateClassName;
// 我们定义了一个自定义插入点，JSS将寻找在DOM中注入样式。
jss.options.insertionPoint = 'insertion-point-jss';

function App() {
  return (
    <JssProvider jss={jss}>
      ...
    </JssProvider>
  );
}

export default App;
```

## 互操作性

### React JSS

Material-UI的样式化解决方案与[react-jss](https://github.com/cssinjs/react-jss)共享许多构建块。
为了处理我们的独特需求，我们进行了这个项目。
我们正在研究如何将Material-UI的更改和修复合并到react-jss中。

{{demo='pages/customization/ReactJss.js'}}

## JssProvider

react-jss 暴露了一个 `JssProvider`组件来为底层的子组件配置JSS， 
这些是不同的用例:
- [Providing a Sheets registry.](/customization/css-in-js#sheets-registry)
- Providing a JSS instance. 你可能想要支持 [Right-to-left](/guides/right-to-left) 或者 改变 [CSS 注入顺序](/customization/css-in-js#css-injection-order).
阅读 [ JSS 文档](http://cssinjs.org/js-api) 了解更多可用的选项。

这里是一个示例:

```jsx
import JssProvider from 'react-jss/lib/JssProvider';
import { create } from 'jss';
import preset from 'jss-preset-default';
import createGenerateClassName from 'material-ui/styles/createGenerateClassName';

const jss = create(preset());
// 自定义 Material-UI class名字以更好的调试和优化性能。 
jss.options.createGenerateClassName = createGenerateClassName;

function App() {
  return (
    <JssProvider jss={jss}>
      ...
    </JssProvider>
  );
}

export default App;
```

## API

### `withStyles(styles, [options]) => Higher-order Component`

连接一个样式表到组件。它不会修改传递给他的组件，相反，它会返回一个新的带有`classes`属性的组件。`classes`对象包含被注入到DOM中的class name的名称。

一些实现细节可能会很有趣:
- 它添加一个`classes`属性，所以你可以从外部覆盖这个被注入的class name。
- 它添加一个`innerRef`属性，所以你可以获取被包裹的组件。
- 它转发*non react 静态*属性，因此这个高阶组件更“透明”。
比如, 它可以被用来定义一个`getInitialProps()` 静态方法(next.js).

#### 参数

1. `styles` (*Function | Object*): 生成样式或对象的函数。

它将被连接到这个组件上。
如果您需要访问主题，请使用函数签名。它是第一个参数。

2. `options` (*Object* [optional]):
    - `options.withTheme` (Boolean [optional]): 提供 `theme` 对象到组件作为它的属性。 默认值为`false`。
    - `options.name` (*String* [optional]): 样式表的名称。用于调试。
    如果没有提供该值，我们将尝试回退到组件的名称。
    - `options.flip` (*Boolean* [optional]): 当设置为false时，此表单将退出`rtl`转换。
    - 其他的键被转发到[jss.createStyleSheet()](http://cssinjs.org/js-api/#create-style-sheet)的options参数中。

#### 返回值

`高阶组件`: 应该被用于包装其他组件。

#### 示例

```js
import { withStyles } from 'material-ui/styles';

const styles = {
  root: {
    background: 'red',
  },
};

class MyComponent extends React.Component {
  render () {
    return <div className={this.props.classes.root} />;
  }
}

export default withStyles(styles)(MyComponent);
```
同样，你也可以作为[装饰者](https://babeljs.io/docs/plugins/transform-decorators/)使用 像这样:

```js
import { withStyles } from 'material-ui/styles';

const styles = {
  root: {
    background: 'red',
  },
};

@withStyles(styles)
class MyComponent extends React.Component {
  render () {
    return <div className={this.props.classes.root} />;
  }
}

export default MyComponent
```
